<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Linkage Mechanisms & Kinematics Quiz</title>
    <style>
        :root {
            /* Teal/Slate Theme based on the Mechanism slides */
            --primary: #263238;
            --secondary: #00897b;
            --accent: #ff6f00;
            --light: #eceff1;
            --success: #43a047;
            --danger: #d32f2f;
            --header-height: 60px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
            margin: 0; padding: 0; display: flex; height: 100vh; color: #37474f; overflow: hidden;
        }

        /* --- Mobile Header --- */
        .mobile-header {
            display: none; height: var(--header-height); background: var(--primary);
            align-items: center; padding: 0 15px; justify-content: space-between;
            position: fixed; top: 0; left: 0; right: 0; z-index: 50;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); color: white;
        }
        .mobile-menu-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 5px; }
        .mobile-timer { font-weight: bold; font-variant-numeric: tabular-nums; background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 4px; color: #80cbc4; }

        /* --- Sidebar --- */
        .sidebar {
            width: 280px; background-color: var(--primary); color: white;
            display: flex; flex-direction: column; padding: 20px;
            box-shadow: 4px 0 10px rgba(0,0,0,0.15); overflow-y: auto; z-index: 100;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .sidebar-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 90; backdrop-filter: blur(2px); }

        .timer-box {
            background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;
            text-align: center; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .timer-label { font-size: 0.85em; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; }
        .timer-display { font-size: 2.2em; font-weight: bold; font-variant-numeric: tabular-nums; margin-top: 5px; color: #80cbc4; }
        .timer-warning { color: var(--accent); animation: pulse 1s infinite; }

        .question-nav { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .nav-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: white; padding: 10px 0; border-radius: 4px; cursor: pointer;
            transition: all 0.2s ease; font-size: 0.9em;
        }
        .nav-btn:hover { background: var(--secondary); transform: translateY(-2px); }
        .nav-btn.active { background: var(--secondary); font-weight: bold; border-color: #b2dfdb; box-shadow: 0 0 8px rgba(0, 137, 123, 0.6); }
        .nav-btn.answered { background: var(--success); border-color: var(--success); }
        .nav-btn.flagged { border-color: var(--accent); color: var(--accent); background: rgba(255, 111, 0, 0.2); }

        /* --- Main Content --- */
        .main-content {
            flex: 1; padding: 40px; overflow-y: auto; position: relative;
            background: linear-gradient(135deg, #eceff1 0%, #cfd8dc 100%);
        }
        .quiz-container {
            max-width: 850px; margin: 0 auto; background: white; padding: 50px;
            border-radius: 15px; box-shadow: 0 15px 35px rgba(0,0,0,0.08);
            animation: fadeIn 0.5s ease; border-top: 6px solid var(--secondary);
        }
        .question-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid var(--light); padding-bottom: 20px; }
        .badge { background: #e0f2f1; color: var(--secondary); padding: 6px 15px; border-radius: 20px; font-weight: bold; font-size: 0.9em; border: 1px solid #b2dfdb; }
        .question-text { font-size: 1.25em; margin-bottom: 35px; line-height: 1.6; color: #263238; }

        .options-grid { display: grid; gap: 15px; }
        .option-label {
            display: flex; align-items: center; padding: 18px 25px;
            border: 2px solid var(--light); border-radius: 10px; cursor: pointer;
            transition: all 0.2s; background: white;
        }
        .option-label:hover { border-color: var(--secondary); background: #e0f2f1; transform: translateX(5px); }
        .option-label.selected { border-color: var(--secondary); background-color: #b2dfdb; box-shadow: 0 4px 10px rgba(0, 137, 123, 0.15); }
        input[type="radio"] { margin-right: 20px; transform: scale(1.3); accent-color: var(--secondary); flex-shrink: 0; }

        .controls { display: flex; justify-content: space-between; margin-top: 50px; padding-top: 25px; border-top: 1px solid var(--light); }
        .btn { padding: 12px 30px; border: none; border-radius: 6px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn:active { transform: scale(0.96); }
        .btn-secondary { background: #cfd8dc; color: #455a64; }
        .btn-secondary:hover { background: #b0bec5; }
        .btn-primary { background: var(--secondary); color: white; box-shadow: 0 4px 15px rgba(0, 137, 123, 0.3); }
        .btn-primary:hover { background: #00796b; }
        .btn-accent { background: white; border: 2px solid var(--accent); color: var(--accent); }
        .btn-accent.active { background: var(--accent); color: white; }
        .btn-success { background: var(--success); color: white; box-shadow: 0 4px 15px rgba(67, 160, 71, 0.3); }

        /* Results Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(38, 50, 56, 0.9); justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(5px); }
        .modal-content { background: white; padding: 50px; border-radius: 20px; text-align: center; max-width: 550px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); max-height: 90vh; overflow-y: auto; }
        .score-circle { width: 180px; height: 180px; border-radius: 50%; border: 12px solid var(--secondary); margin: 30px auto; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 3.5em; font-weight: 800; color: var(--primary); position: relative; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .mjx-chtml { outline: 0; }

        /* --- MOBILE OPTIMIZATIONS --- */
        @media (max-width: 900px) {
            body { flex-direction: column; }
            .mobile-header { display: flex; }
            .sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: 85%; max-width: 320px; transform: translateX(-100%); border-right: none; }
            .sidebar.open { transform: translateX(0); }
            .sidebar-overlay.active { display: block; }
            .main-content { padding: 20px; padding-top: calc(var(--header-height) + 20px); }
            .quiz-container { padding: 25px; border-radius: 8px; }
            .question-text { font-size: 1.1em; }
            .option-label { padding: 15px; font-size: 0.95em; }
            .controls { flex-direction: column; gap: 15px; }
            .controls > button { width: 100%; }
            .controls > div { display: flex; width: 100%; gap: 10px; }
            .controls > div > button { flex: 1; }
            .sidebar .timer-box { display: none; }
        }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

<div class="sidebar-overlay" onclick="toggleSidebar()"></div>

<header class="mobile-header">
    <button class="mobile-menu-btn" onclick="toggleSidebar()">☰</button>
    <span style="font-weight:700; font-size: 1.1em;">Quiz 03</span>
    <div class="mobile-timer" id="mobileTimer">30:00</div>
</header>

<div class="sidebar" id="sidebar">
    <div class="timer-box">
        <div class="timer-label">Time Remaining</div>
        <div class="timer-display" id="timer">30:00</div>
    </div>
    <div style="margin-bottom: 15px; font-size: 0.85em; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.6);">Question Overview</div>
    <div class="question-nav" id="navGrid"></div>
</div>

<div class="main-content">
    <div class="quiz-container" id="quizContainer">
        <div class="question-header">
            <h2 style="margin:0; font-weight: 700; color: var(--primary); font-size: 1.2rem;">Question <span id="currentQNum">1</span><span style="color:#b0bec5; font-weight:300;"> / 20</span></h2>
            <div class="badge">5 Marks Each</div>
        </div>

        <div class="question-text" id="questionText"></div>
        <div class="options-grid" id="optionsContainer"></div>

        <div class="controls">
            <button class="btn btn-accent" id="flagBtn" onclick="toggleFlag()">
                <span id="flagIcon">⚑</span> <span id="flagText">Flag</span>
            </button>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" id="prevBtn" onclick="changeQuestion(-1)">Prev</button>
                <button class="btn btn-primary" id="nextBtn" onclick="changeQuestion(1)">Next</button>
                <button class="btn btn-success" id="submitBtn" style="display:none;" onclick="submitQuiz()">Submit</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="resultModal">
    <div class="modal-content">
        <h2 style="color: var(--primary); margin-bottom: 10px;">Quiz Submitted</h2>
        <p style="color: #78909c;">Your score has been recorded to your dashboard.</p>

        <div class="score-circle">
            <span id="finalScore">0</span>
            <span class="score-sub" style="font-size: 12px; margin-top: -5px;">Total Score</span>
        </div>

        <p id="feedbackText" style="font-size: 1.1em; margin-bottom: 30px; padding: 0 10px;"></p>

        <div style="display:flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
            <button class="btn btn-primary" onclick="window.close()">Return to Dashboard</button>
        </div>
    </div>
</div>

<script>
    // --- INTEGRATION CONFIGURATION ---
    // This MUST match the index in your Dashboard (index.html)
    // 0=Lec1... 10=Quiz2... 12=Quiz3
    const QUIZ_ID = "q_12";
    const QUIZ_TITLE = "Quiz 03: Mechanisms";

    // --- Quiz Data ---
    const quizData = [
        { q: "A 'Kinematic Link' is best defined as:", options: [ "A flexible body that transmits power through tension", "A resistant body in a machine which moves relative to another resistant body", "A point where two bodies connect without relative motion", "A rigid structure with zero degrees of freedom" ], correct: 1 },
        { q: "What is the primary difference between a 'Kinematic Chain' and a 'Mechanism'?", options: [ "A mechanism has more links than a chain", "A chain is used for power transmission, a mechanism for force", "A mechanism has at least one link that is fixed (grounded)", "A mechanism uses only higher pairs" ], correct: 2 },
        { q: "Which of the following defines a 'Lower Pair'?", options: [ "A connection with point contact", "A connection with line contact", "A connection with surface (area) contact", "A connection that allows no motion" ], correct: 2 },
        { q: "A ball bearing or two gear teeth in contact are examples of which type of pair?", options: [ "Lower Pair", "Higher Pair", "Revolute Pair", "Prismatic Pair" ], correct: 1 },
        { q: "A piston sliding inside a cylinder (slider-crank mechanism) forms which type of kinematic pair?", options: [ "Revolute Pair", "Spherical Pair", "Prismatic Pair", "Screw Pair" ], correct: 2 },
        { q: "According to Gruebler's Equation for a planar mechanism, the Degree of Freedom (DoF) is calculated as:", options: [ "\\( DoF = 3(n-1) - 2L - H \\)", "\\( DoF = 6(n-1) - 5L - H \\)", "\\( DoF = 2(n-1) - L - H \\)", "\\( DoF = n - 2L \\)" ], correct: 0 },
        { q: "In Gruebler's Equation, what does the variable 'n' represent?", options: [ "Number of joints", "Number of loops", "Total number of links (including the fixed link)", "Number of moving links only" ], correct: 2 },
        { q: "Consider a structure with 3 links and 3 lower pairs (a triangle). What is its Degree of Freedom according to Gruebler's equation?", options: [ "1 (Mechanism)", "0 (Structure/Truss)", "-1 (Superstructure)", "2 (Differential)" ], correct: 1 },
        { q: "A 'Crank-Rocker' mechanism is a four-bar linkage where:", options: [ "Both the input and output links can rotate 360 degrees", "Both the input and output links can only oscillate", "One link rotates 360 degrees while the other oscillates", "The shortest link is the coupler" ], correct: 2 },
        { q: "In a 'Double Crank' mechanism:", options: [ "The shortest link is fixed", "The shortest link is the coupler", "No link can make a full revolution", "The input and output links both make full revolutions" ], correct: 3 },
        { q: "The locomotive mechanism (coupling rod of a locomotive) shown in the slides is an example of:", options: [ "Double Rocker Mechanism", "Double Crank Mechanism", "Crank Rocker Mechanism", "Slider Crank Mechanism" ], correct: 1 },
        { q: "What is the Degree of Freedom of a standard 4-bar linkage (4 links, 4 revolute pairs, 0 higher pairs)?", options: [ "0", "1", "2", "3" ], correct: 1 },
        { q: "In the context of acceleration vectors, the 'Radial' or 'Centripetal' acceleration component is calculated as:", options: [ "\\( r \\times \\alpha \\)", "\\( \\frac{V^2}{r} \\)", "\\( \\frac{d\\omega}{dt} \\)", "\\( V \\times r \\)" ], correct: 1 },
        { q: "The 'Tangential' acceleration component is dependent on:", options: [ "Angular velocity (\\( \\omega \\))", "Angular acceleration (\\( \\alpha \\))", "Linear position only", "Mass of the link" ], correct: 1 },
        { q: "A mechanism with 4 links, 3 lower pairs, and 1 higher pair (e.g., a Cam and Follower) has a Degree of Freedom of:", options: [ "0", "1", "2", "3" ], correct: 2 },
        { q: "If a point B is on a rotating link pivoted at O, the velocity vector \\( v_{BO} \\) is always:", options: [ "Parallel to the link BO", "Perpendicular to the link BO", "At 45 degrees to the link BO", "Directed towards the center O" ], correct: 1 },
        { q: "Which kinematic pair allows 3 Degrees of Freedom (rotations about 3 axes)?", options: [ "Revolute Pair", "Prismatic Pair", "Spherical Pair", "Cylindrical Pair" ], correct: 2 },
        { q: "A 'Screw Pair' (like a nut and bolt) allows how many Degrees of Freedom?", options: [ "1 (Correlated rotation and translation)", "2 (Independent rotation and translation)", "3", "0" ], correct: 0 },
        { q: "In a Slider-Crank mechanism, the reciprocating part is usually called the:", options: [ "Crank", "Connecting Rod", "Piston (or Slider)", "Frame" ], correct: 2 },
        { q: "The 'Whitworth Quick Return Mechanism' is a modification of which basic mechanism?", options: [ "Double Rocker", "Slider Crank Mechanism", "Four Bar Chain", "Cam Follower" ], correct: 1 }
    ];

    // --- State Variables ---
    let currentQuestion = 0;
    let userAnswers = new Array(quizData.length).fill(null);
    let flaggedQuestions = new Array(quizData.length).fill(false);
    let timeLeft = 30 * 60;
    let timerInterval;

    // --- DOM Elements ---
    const sidebar = document.getElementById('sidebar');
    const overlay = document.querySelector('.sidebar-overlay');
    const mobileTimer = document.getElementById('mobileTimer');
    const desktopTimer = document.getElementById('timer');

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        initNavigation();
        loadQuestion(0);
        startTimer();
    });

    // --- Sidebar / Mobile Functions ---
    function toggleSidebar() {
        sidebar.classList.toggle('open');
        overlay.classList.toggle('active');
        overlay.style.display = sidebar.classList.contains('open') ? 'block' : 'none';
    }

    // --- Core Logic ---
    function startTimer() {
        timerInterval = setInterval(() => {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            desktopTimer.textContent = timeString;
            mobileTimer.textContent = timeString;

            if (timeLeft <= 60) {
                desktopTimer.classList.add('timer-warning');
                mobileTimer.style.color = 'var(--accent)';
            }

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                submitQuiz();
            }
        }, 1000);
    }

    function initNavigation() {
        const navGrid = document.getElementById('navGrid');
        navGrid.innerHTML = '';
        quizData.forEach((_, index) => {
            const btn = document.createElement('button');
            btn.className = 'nav-btn';
            btn.textContent = index + 1;
            btn.onclick = () => {
                loadQuestion(index);
                if(window.innerWidth <= 900) toggleSidebar();
            };
            btn.id = `nav-${index}`;
            navGrid.appendChild(btn);
        });
    }

    function loadQuestion(index) {
        currentQuestion = index;
        document.getElementById('currentQNum').textContent = index + 1;

        const qTextEl = document.getElementById('questionText');
        qTextEl.textContent = quizData[index].q;

        const optionsContainer = document.getElementById('optionsContainer');
        optionsContainer.innerHTML = '';

        quizData[index].options.forEach((opt, optIndex) => {
            const label = document.createElement('label');
            label.className = 'option-label';
            if (userAnswers[index] === optIndex) label.classList.add('selected');

            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'quizOption';
            input.value = optIndex;
            input.checked = userAnswers[index] === optIndex;
            input.onchange = () => selectOption(optIndex);

            const span = document.createElement('span');
            span.textContent = opt;

            label.appendChild(input);
            label.appendChild(span);
            optionsContainer.appendChild(label);
        });

        if (window.MathJax) MathJax.typesetPromise([qTextEl, optionsContainer]);

        document.getElementById('prevBtn').disabled = index === 0;
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');

        if (index === quizData.length - 1) {
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'flex';
        } else {
            nextBtn.style.display = 'flex';
            submitBtn.style.display = 'none';
        }

        const flagBtn = document.getElementById('flagBtn');
        const flagText = document.getElementById('flagText');
        if (flaggedQuestions[index]) {
            flagBtn.classList.add('active');
            flagText.textContent = 'Flagged';
        } else {
            flagBtn.classList.remove('active');
            flagText.textContent = 'Flag';
        }
        updateNavStyles();
    }

    function selectOption(optIndex) {
        userAnswers[currentQuestion] = optIndex;
        const labels = document.querySelectorAll('.option-label');
        labels.forEach((l, i) => {
            if (i === optIndex) l.classList.add('selected');
            else l.classList.remove('selected');
        });
        updateNavStyles();
    }

    function changeQuestion(delta) {
        const newIndex = currentQuestion + delta;
        if (newIndex >= 0 && newIndex < quizData.length) loadQuestion(newIndex);
    }

    function toggleFlag() {
        flaggedQuestions[currentQuestion] = !flaggedQuestions[currentQuestion];
        loadQuestion(currentQuestion);
    }

    function updateNavStyles() {
        quizData.forEach((_, i) => {
            const btn = document.getElementById(`nav-${i}`);
            btn.className = 'nav-btn';
            if (i === currentQuestion) btn.classList.add('active');
            if (userAnswers[i] !== null) btn.classList.add('answered');
            if (flaggedQuestions[i]) btn.classList.add('flagged');
        });
    }

    // --- INTEGRATED SUBMIT FUNCTION ---
    function submitQuiz() {
        clearInterval(timerInterval);
        let score = 0;
        userAnswers.forEach((ans, index) => {
            if (ans === quizData[index].correct) score += 5;
        });

        // 1. Save to Dashboard
        const finalPercentage = score; // 20 questions * 5 marks = 100
        let allQuizData = JSON.parse(localStorage.getItem('quizData')) || {};

        let currentRecord = allQuizData[QUIZ_ID] || { title: QUIZ_TITLE, attempts: 0, score: 0 };
        currentRecord.score = Math.max(currentRecord.score, finalPercentage);

        if(currentRecord.attempts === 0) currentRecord.attempts = 1;

        allQuizData[QUIZ_ID] = currentRecord;
        localStorage.setItem('quizData', JSON.stringify(allQuizData));

        // 2. Display Results
        const scoreElement = document.getElementById('finalScore');
        const feedbackElement = document.getElementById('feedbackText');

        let currentDisplayScore = 0;
        const scoreAnimation = setInterval(() => {
            if (currentDisplayScore < score) {
                currentDisplayScore++;
                scoreElement.textContent = currentDisplayScore;
            } else {
                clearInterval(scoreAnimation);
            }
        }, 20);

        if (score >= 90) {
            feedbackElement.innerHTML = `<strong>Excellent!</strong><br>You have a strong command of Linkage Mechanisms.`;
            document.querySelector('.score-circle').style.borderColor = "var(--success)";
        } else if (score >= 70) {
            feedbackElement.innerHTML = `<strong>Great Job!</strong><br>You understand the core concepts well.`;
            document.querySelector('.score-circle').style.borderColor = "var(--secondary)";
        } else if (score >= 50) {
            feedbackElement.innerHTML = `<strong>Good Effort.</strong><br>Review the definitions of Higher vs. Lower pairs.`;
            document.querySelector('.score-circle').style.borderColor = "var(--accent)";
        } else {
            feedbackElement.innerHTML = `<strong>Keep Practicing.</strong><br>Focus on mechanisms vs. structures.`;
            document.querySelector('.score-circle').style.borderColor = "var(--danger)";
        }

        document.getElementById('resultModal').style.display = 'flex';
    }
</script>
</body>
</html>