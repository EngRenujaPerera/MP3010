<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MP 3010 - Kinematics & Dynamics | Secure Exam Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #800000; /* UOJ Maroon */
            --primary-dark: #5c0000;
            --accent: #ffd700;
            --glass: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.5);
            --text: #333;
            --bg-gradient: linear-gradient(135deg, #1a1a1a 0%, #800000 100%);
        }

        * { box-sizing: border-box; transition: all 0.3s ease; }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- Background Animation --- */
        .bg-particles {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            50% { opacity: 0.5; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        /* --- Sections Management --- */
        .app-section {
            display: none; /* Hidden by default */
            min-height: 100vh;
            padding: 20px;
            justify-content: center;
            align-items: center;
        }

        .active-section {
            display: flex;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Login & Instructions Cards --- */
        .auth-card, .rules-card {
            background: var(--glass);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            text-align: center;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
        }

        .auth-card h1 { color: var(--primary); margin-bottom: 10px; }
        .logo-text { font-size: 0.9rem; color: #666; margin-bottom: 30px; letter-spacing: 1px; }

        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; font-weight: 600; margin-bottom: 5px; color: var(--primary); }
        .input-group input {
            width: 100%; padding: 12px;
            border: 2px solid #ddd; border-radius: 8px;
            font-size: 1rem; outline: none;
        }
        .input-group input:focus { border-color: var(--primary); }

        .btn-main {
            background: var(--primary); color: white;
            padding: 15px 30px; border: none; border-radius: 30px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer;
            width: 100%; box-shadow: 0 4px 15px rgba(128, 0, 0, 0.3);
        }
        .btn-main:hover { transform: translateY(-2px); background: var(--primary-dark); }

        .rules-list { text-align: left; background: #fff5f5; padding: 20px; border-radius: 10px; border-left: 5px solid red; margin-bottom: 25px; }
        .rules-list li { margin-bottom: 10px; font-size: 0.95rem; }

        /* --- Exam Layout --- */
        #exam-interface {
            display: block; width: 100%; max-width: 900px; margin: 0 auto;
        }

        header {
            background: var(--glass);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky; top: 10px; z-index: 100;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .timer-box {
            background: var(--primary); color: white;
            padding: 10px 20px; border-radius: 50px;
            font-weight: bold; font-family: monospace; font-size: 1.2rem;
            box-shadow: 0 0 10px rgba(128,0,0,0.5);
        }

        .exam-card {
            background: var(--glass);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .section-header {
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px; margin-bottom: 20px;
            color: var(--primary); display: flex; justify-content: space-between;
        }

        /* MCQ & Inputs */
        .option-label {
            display: flex; align-items: center;
            padding: 15px; background: white; border: 1px solid #eee;
            border-radius: 8px; cursor: pointer; margin-bottom: 8px;
        }
        .option-label:hover { background: #fff0f0; border-color: var(--primary); }
        .option-label input { margin-right: 15px; accent-color: var(--primary); }

        textarea, input[type="text"], input[type="number"] {
            width: 100%; padding: 12px;
            border: 1px solid #ccc; border-radius: 6px;
            font-family: inherit; margin-top: 5px;
            background: rgba(255,255,255,0.8);
        }
        textarea:focus, input:focus { border-color: var(--primary); background: white; }

        .exam-figure {
            display: block; max-width: 100%; height: auto;
            margin: 15px auto; border-radius: 8px; border: 1px solid #ddd;
        }

        /* File Upload */
        .file-upload-box {
            border: 2px dashed var(--primary);
            background: rgba(128, 0, 0, 0.05);
            padding: 20px; border-radius: 10px;
            text-align: center; margin: 15px 0;
            cursor: pointer; position: relative;
        }
        .file-upload-box:hover { background: rgba(128, 0, 0, 0.1); }

        /* Modal */
        #result-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000; display: none;
            justify-content: center; align-items: center;
        }
        .result-content {
            background: white; padding: 50px; border-radius: 20px;
            text-align: center; max-width: 500px;
            animation: slideUp 0.5s ease;
        }
        .violation-alert { color: red; font-weight: bold; margin-bottom: 10px; display: none; }

        @keyframes slideUp { from { transform: translateY(100px); } to { transform: translateY(0); } }

        /* Math Display */
        .math-display { font-family: "Cambria Math", serif; font-size: 1.1rem; background: #fff; padding: 10px; border-radius: 5px; border: 1px solid #eee; display: inline-block;}

    </style>
</head>
<body>

<div class="bg-particles" id="particles"></div>

<section id="sec-login" class="app-section active-section">
    <div class="auth-card">
        <h1>Welcome</h1>
        <div class="logo-text"><br>FACULTY OF ENGINEERING</div>
        <h2>MP3010 - Kinematics & Dynamics</h2>
        <p>End Semester Examination</p>

        <form id="loginForm" onsubmit="handleLogin(event)">
            <div class="input-group">
                <label>Full Name</label>
                <input type="text" id="studentName" required placeholder="Ex: Joe Stare">
            </div>
            <div class="input-group">
                <label>Registration Number</label>
                <input type="text" id="regNum" required placeholder="Ex: 202X/E/XXX">
            </div>
            <button type="submit" class="btn-main">Proceed to Instructions</button>
        </form>
    </div>
</section>

<section id="sec-instructions" class="app-section">
    <div class="rules-card">
        <h1>Examination Rules</h1>
        <p>Please read carefully before starting.</p>

        <ul class="rules-list">
            <li><strong>Duration:</strong> You have exactly 2 hours.</li>
            <li><strong>Files:</strong> You can upload images/PDFs for structured questions (Max 5MB).</li>
            <li><strong>Equations:</strong> Useful equations are provided at the bottom of the paper.</li>
            <li style="color: #d32f2f; font-weight: bold; margin-top: 15px;">‚ö†Ô∏è SECURITY WARNING:</li>
            <li>This exam is monitored. <strong>Do not leave this tab.</strong></li>
            <li>If you switch tabs, minimize the window, or open another application, the exam will <strong>automatically submit</strong> and record a violation.</li>
        </ul>

        <div class="input-group" style="text-align: center;">
            <label style="display:inline-flex; align-items:center; justify-content:center;">
                <input type="checkbox" id="agreeCheck" style="width:auto; margin-right:10px;">
                I understand the rules and agree to the monitoring.
            </label>
        </div>

        <button onclick="startExam()" class="btn-main" id="startBtn" style="opacity: 0.5; pointer-events: none;">Start Examination</button>
    </div>
</section>

<section id="sec-exam" class="app-section" style="display: none; align-items: flex-start; padding-top: 20px;">
    <div id="exam-interface">
        <header>
            <div>
                <h2 style="margin:0; font-size: 1.2rem;">MP 3010</h2>
                <span id="displayStudentName" style="font-size: 0.9rem; opacity: 0.8;">Student</span>
            </div>
            <div class="timer-box" id="timer">02:00:00</div>
        </header>

        <form id="examForm">
            <div class="exam-card">
                <div class="section-header">
                    <h3>Question 01 (20 Marks)</h3>
                    <span>MCQ</span>
                </div>
                <div id="mcq-container"></div>
            </div>

            <div class="exam-card">
                <div class="section-header"><h3>Question 02 (20 Marks)</h3></div>

                <p><strong>A.</strong> Identify mechanisms A, B, C.</p>
                <img src="1.png" alt="Linkage Mechanism" class="exam-figure">
                <input type="text" placeholder="Identify A" style="margin-bottom:5px;">
                <input type="text" placeholder="Identify B" style="margin-bottom:5px;">
                <input type="text" placeholder="Identify C">

                <hr style="margin: 20px 0; border:0; border-top:1px dashed #ccc;">

                <p><strong>B.</strong> Gruebler's Equation: <span class="math-display">DOF = 3(n-1) - 2L - H</span></p>
                <p>Calculate DOF for Figure 02:</p>
                <img src="2.png" alt="Mechanism" class="exam-figure">
                <textarea placeholder="Calculation steps..."></textarea>

                <hr style="margin: 20px 0; border:0; border-top:1px dashed #ccc;">

                <p><strong>C.</strong> Robotic Arm at P=(5,2,7). Euler rotations.</p>
                <textarea placeholder="Rotation Matrix and Final Coordinates..."></textarea>
            </div>

            <div class="exam-card">
                <div class="section-header"><h3>Question 03 (35 Marks)</h3></div>
                <p><strong>A. Oscillating Link OAB (90 rpm CCW)</strong></p>
                <img src="3.png" alt="Oscillating Link" class="exam-figure">

                <div class="file-upload-box">
                    <label>üì∑ Upload Velocity Diagram</label>
                    <input type="file" accept="image/*,.pdf" onchange="validateFileSize(this)">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input type="number" placeholder="Velocity of C (m/s)">
                    <input type="number" placeholder="Ang. Vel AC (rad/s)">
                </div>
                <input type="text" placeholder="Rubbing Velocities (O, A, C)">

                <hr style="margin: 20px 0; border:0; border-top:1px dashed #ccc;">

                <p><strong>B. Four Bar Chain PQRS</strong></p>
                <p>Draw velocity/acceleration diagram when QPS=60¬∞.</p>
                <div class="file-upload-box">
                    <label>üì∑ Upload Vec/Acc Diagram</label>
                    <input type="file" accept="image/*,.pdf" onchange="validateFileSize(this)">
                </div>
                <textarea placeholder="Angular Velocity & Acceleration of QR & RS"></textarea>
            </div>

            <div class="exam-card">
                <div class="section-header"><h3>Question 04 (18 Marks)</h3></div>
                <p><strong>A. Gear Design (Pinion 20T, Wheel 50T)</strong></p>
                <input type="text" placeholder="(a) Length of path of approach">
                <input type="text" placeholder="(b) Length of arc of approach">

                <hr style="margin: 20px 0; border:0; border-top:1px dashed #ccc;">

                <p><strong>B. Compound Gear Train</strong></p>
                <img src="4.png" alt="Gear Train" class="exam-figure">
                <textarea placeholder="Speed of Gear 7, Diameters, Velocity Ratios..."></textarea>

                <hr style="margin: 20px 0; border:0; border-top:1px dashed #ccc;">

                <p><strong>C. Reverted Epicyclic Gear Train</strong></p>
                <img src="5.png" alt="Epicyclic Train" class="exam-figure">
                <textarea placeholder="1. Number of teeth on C and D...&#10;2. Speed of wheel D..."></textarea>
            </div>

             <div class="exam-card">
                <div class="section-header"><h3>Question 05 (12 Marks)</h3></div>
                <p><strong>Cam Profile Design</strong></p>
                <div class="file-upload-box">
                    <label>üì∑ Upload Cam Profile Drawings</label>
                    <input type="file" accept="image/*,.pdf" onchange="validateFileSize(this)">
                </div>
                <input type="text" placeholder="Max Velocity (Outward & Return)">
                <input type="text" placeholder="Max Acceleration (Outward & Return)">
            </div>

            <div class="exam-card" style="background: #fffdfd; border: 1px solid var(--primary);">
                <h3 style="color:var(--primary); margin-top:0;">Useful Equations</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div class="math-display">KP = &radic;(R<sub>A</sub><sup>2</sup> - R<sup>2</sup>cos<sup>2</sup>&Phi;) - R sin&Phi;</div>
                    <div class="math-display">M = D / T</div>
                    <div class="math-display">Speed Ratio = Teeth(Driven) / Teeth(Drivers)</div>
                    <div class="math-display">V<sub>R</sub> = &pi;&omega;S / 2&theta;<sub>R</sub></div>
                    <div class="math-display">a<sub>R</sub> = &pi;<sup>2</sup>&omega;<sup>2</sup>S / 2(&theta;<sub>R</sub>)<sup>2</sup></div>
                </div>
            </div>

            <button type="button" class="btn-main" onclick="submitExam('manual')">Submit Examination</button>
        </form>
    </div>
</section>

<div id="result-modal">
    <div class="result-content">
        <h2 id="result-title">Examination Completed</h2>
        <p id="violation-msg" class="violation-alert">‚ö†Ô∏è VIOLATION DETECTED: TAB SWITCHED</p>

        <div style="width: 100px; height: 100px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; margin: 20px auto;">
            <span id="score-display">0</span>
        </div>
        <p><strong>Part 1 (MCQ) Score / 20</strong></p>
        <p style="font-size: 0.9rem; color: #666;">
            Your structured answers and drawings have been encrypted and stored locally.
            Please inform the invigilator.
        </p>
        <button class="btn-main" onclick="location.reload()">Return to Home</button>
    </div>
</div>

<script>
    // --- Global State ---
    let examActive = false;
    let studentInfo = { name: '', reg: '' };
    let timerInterval;

    // --- Background Particles ---
    const particlesContainer = document.getElementById('particles');
    for(let i=0; i<30; i++){
        let p = document.createElement('div');
        p.className = 'particle';
        p.style.left = Math.random() * 100 + 'vw';
        p.style.width = (Math.random() * 10 + 5) + 'px';
        p.style.height = p.style.width;
        p.style.animationDuration = (Math.random() * 10 + 10) + 's';
        particlesContainer.appendChild(p);
    }

    // --- MCQ Data ---
    const quizData = [
        { id: 1, question: "1. What does the parameterization of rigid body motion include?", options: ["Body angular velocity and spatial angular velocity", "Force moments and inertia", "Euler's rigid body equations", "All of the above"], correct: 3 },
        { id: 2, question: "2. What is conserved in the conservation of spatial angular momentum?", options: ["Magnitude of body angular momentum", "Gyroscopic motion", "Spinning top", "None of the above"], correct: 0 },
        { id: 3, question: "3. Which principle is associated with MEMS accelerometers and gyroscopes?", options: ["Working principle", "Conservation principle", "Kinetic energy principle", "Force moment principle"], correct: 0 },
        { id: 4, question: "4. What are kinematic chains?", options: ["Mechanisms and kinematic inversions", "Pairs and degrees of freedom", "Four bar mechanisms", "All of the above"], correct: 3 },
        { id: 5, question: "5. What law is related to four bar mechanisms?", options: ["Grashof's law", "Newton's law", "Euler's law", "Kennedy's theorem"], correct: 0 },
        { id: 6, question: "6. What theorem is associated with instantaneous center?", options: ["Kennedy's theorem", "Grashof's theorem", "Euler's theorem", "Newton's theorem"], correct: 0 },
        { id: 7, question: "7. What is the law of gear meshing related to?", options: ["Gear types and trains", "Gear design parameters", "Cam drives", "Both gear types and design parameters"], correct: 3 },
        { id: 8, question: "8. What are cam drives used for?", options: ["Transmitting motion", "Changing speed", "Changing direction", "All of the above"], correct: 3 },
        { id: 9, question: "9. What does Euler's rigid body equations describe?", options: ["Rotating bodies", "Translating bodies", "Both rotating and translating bodies", "None of the above"], correct: 0 },
        { id: 10, question: "10. What is gyroscopic motion related to?", options: ["Conservation of spatial angular momentum", "Spinning top", "Both conservation and spinning top", "None of the above"], correct: 2 }
    ];

    // --- Render MCQs ---
    const mcqContainer = document.getElementById('mcq-container');
    quizData.forEach((q, index) => {
        const div = document.createElement('div');
        div.style.marginBottom = '20px';
        let opts = '';
        q.options.forEach((opt, i) => {
            opts += `<label class="option-label"><input type="radio" name="q${index}" value="${i}"> ${opt}</label>`;
        });
        div.innerHTML = `<p style="font-weight:600;">${q.question}</p>${opts}`;
        mcqContainer.appendChild(div);
    });

    // --- Navigation Functions ---
    function switchSection(fromId, toId) {
        document.getElementById(fromId).classList.remove('active-section');
        document.getElementById(fromId).style.display = 'none';

        const toSection = document.getElementById(toId);
        toSection.style.display = (toId === 'sec-exam') ? 'block' : 'flex';
        setTimeout(() => {
            toSection.classList.add('active-section');
        }, 10);
        window.scrollTo(0,0);
    }

    function handleLogin(e) {
        e.preventDefault();
        studentInfo.name = document.getElementById('studentName').value;
        studentInfo.reg = document.getElementById('regNum').value;

        if(studentInfo.name && studentInfo.reg) {
            switchSection('sec-login', 'sec-instructions');
        }
    }

    // Enable Start Button only when checkbox checked
    document.getElementById('agreeCheck').addEventListener('change', function() {
        const btn = document.getElementById('startBtn');
        if(this.checked) {
            btn.style.opacity = '1';
            btn.style.pointerEvents = 'auto';
        } else {
            btn.style.opacity = '0.5';
            btn.style.pointerEvents = 'none';
        }
    });

    // --- SECURITY: Anti-Cheat Logic ---
    function startExam() {
        if (!document.fullscreenElement) {
            // Request full screen for better immersion (optional, browser may block)
            document.documentElement.requestFullscreen().catch(e => console.log(e));
        }

        document.getElementById('displayStudentName').innerText = `${studentInfo.name} | ${studentInfo.reg}`;
        switchSection('sec-instructions', 'sec-exam');

        examActive = true;
        startTimer();

        // ** CORE SECURITY FEATURE **
        // Trigger submit if visibility changes (Tab switch/Minimize)
        document.addEventListener('visibilitychange', handleVisibilityChange);
        window.addEventListener('blur', handleWindowBlur);
    }

    function handleVisibilityChange() {
        if (examActive && document.visibilityState === 'hidden') {
            submitExam('violation');
        }
    }

    function handleWindowBlur() {
        // Blur can be sensitive (e.g. clicking a system notification),
        // but for high security requested, we trigger it.
        if (examActive) {
            submitExam('violation');
        }
    }

    // --- Timer ---
    function startTimer() {
        let timeLimit = 2 * 60 * 60; // 2 hours
        const display = document.getElementById('timer');

        timerInterval = setInterval(() => {
            if(!examActive) { clearInterval(timerInterval); return; }

            const h = Math.floor(timeLimit / 3600);
            const m = Math.floor((timeLimit % 3600) / 60);
            const s = timeLimit % 60;
            display.textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;

            if (timeLimit <= 0) {
                submitExam('timeout');
            }
            timeLimit--;
        }, 1000);
    }

    // --- File Validation ---
    function validateFileSize(input) {
        if (input.files && input.files[0]) {
            if (input.files[0].size > 5 * 1024 * 1024) {
                alert('File is too large! Max 5MB.');
                input.value = '';
            }
        }
    }

    // --- Submission ---
    function submitExam(reason) {
        if (!examActive) return; // Prevent double submission
        examActive = false;
        clearInterval(timerInterval);

        // Remove security listeners
        document.removeEventListener('visibilitychange', handleVisibilityChange);
        window.removeEventListener('blur', handleWindowBlur);

        // Calculate Score
        let score = 0;
        quizData.forEach((q, index) => {
            const selected = document.querySelector(`input[name="q${index}"]:checked`);
            if (selected && parseInt(selected.value) === q.correct) score += 2;
        });

        // UI Updates for Result
        const modal = document.getElementById('result-modal');
        const violationMsg = document.getElementById('violation-msg');
        const title = document.getElementById('result-title');

        if (reason === 'violation') {
            title.innerText = "EXAM TERMINATED";
            title.style.color = "red";
            violationMsg.style.display = "block";
            // Play a harsh sound or alert
            alert("SECURITY VIOLATION: You switched tabs or windows. The exam has been auto-submitted.");
        } else if (reason === 'timeout') {
            title.innerText = "Time Up!";
        }

        document.getElementById('score-display').innerText = score;
        modal.style.display = 'flex';
    }
</script>

</body>
</html>
