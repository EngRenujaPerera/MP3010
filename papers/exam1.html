<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MP 3010 - Kinematics & Dynamics | UOJ Secure Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* UNIVERSITY OF JAFFNA MAROON THEME */
            --primary: #800000;
            --primary-dark: #5c0000;
            --accent: #FFD700;
            --glass: rgba(255, 255, 255, 0.95);
            --text: #333;
            --bg-gradient: linear-gradient(135deg, #2b0000 0%, #800000 50%, #1a1a1a 100%);
        }

        * { box-sizing: border-box; transition: all 0.2s ease; }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0; padding: 0;
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text);
            min-height: 100vh;
        }

        /* --- UI Components --- */
        .app-section { display: none; min-height: 100vh; padding: 20px; justify-content: center; align-items: center; }
        .active-section { display: flex; animation: fadeIn 0.4s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .glass-card {
            background: var(--glass); padding: 40px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 600px; width: 100%;
            text-align: center; border: 1px solid rgba(255,255,255,0.5);
        }

        .btn-main {
            background: var(--primary); color: white; padding: 15px 30px;
            border: none; border-radius: 30px; font-size: 1.1rem; font-weight: bold;
            cursor: pointer; width: 100%; margin-top: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* DISABLED STATE STYLE */
        .btn-main:disabled {
            background: #cccccc; color: #888888; cursor: not-allowed;
            transform: none !important; box-shadow: none;
        }
        .btn-main:hover:not(:disabled) { background: var(--primary-dark); transform: translateY(-2px); }

        input[type="text"], input[type="number"], textarea {
            width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;
            margin-bottom: 15px; font-family: inherit;
        }
        input:focus, textarea:focus { border-color: var(--primary); outline: none; }

        /* --- Exam Layout --- */
        #exam-interface { display: block; width: 100%; max-width: 900px; margin: 0 auto; padding-bottom: 50px;}

        header {
            background: white; border-radius: 15px; padding: 15px 25px; margin-bottom: 25px;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 10px; z-index: 100; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid var(--primary);
        }

        .exam-card { background: white; border-radius: 15px; padding: 30px; margin-bottom: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .section-header { border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 20px; color: var(--primary); }
        .exam-figure { display: block; max-width: 100%; height: auto; margin: 15px auto; border: 1px solid #ddd; border-radius: 5px; }

        /* --- Upload Widget --- */
        .upload-area {
            border: 2px dashed var(--primary); background: #fffdfd; padding: 20px;
            border-radius: 10px; text-align: center; margin: 15px 0;
        }
        .btn-cam { background: #2c3e50; color: white; padding: 8px 15px; border-radius: 5px; border: none; cursor: pointer; margin: 5px; }
        .btn-file { background: #7f8c8d; color: white; padding: 8px 15px; border-radius: 5px; border: none; cursor: pointer; margin: 5px; }
        .preview-img { max-width: 100%; max-height: 250px; display: none; margin-top: 10px; border: 1px solid #ccc; }

        /* --- Table Style for Q4 --- */
        .gear-table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.9rem; }
        .gear-table th, .gear-table td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        .gear-table th { background-color: var(--primary); color: white; }

        /* --- MODALS (POPUPS) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 3000;
            display: none; /* Hidden by default */
            flex-direction: column; justify-content: center; align-items: center;
        }
        
        #camera-feed { width: 90%; max-width: 600px; background: black; border: 2px solid white; border-radius: 10px; }
        
        .alert-box {
            background: white; padding: 40px; border-radius: 15px; text-align: center; max-width: 500px;
            animation: popUp 0.3s ease-out;
        }
        @keyframes popUp { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }

    </style>
</head>
<body>

<section id="sec-login" class="app-section active-section">
    <div class="glass-card">
        <h1 style="color:var(--primary); margin:0;">VIRTUAL LEARNING ENVIRONMENT</h1>
        <p style="font-weight:bold; color:#555;">FACULTY OF ENGINEERING</p>
        <h2 style="margin-top:20px;">MP 3010: Kinematics & Dynamics</h2>
        <p>End Semester Examination</p>

        <form onsubmit="handleLogin(event)">
            <input type="text" id="studentName" required placeholder="Student Name">
            <input type="text" id="regNum" required placeholder="Registration Number (202X/E/XXX)">
            <button class="btn-main">Enter Portal</button>
        </form>
    </div>
</section>

<section id="sec-instructions" class="app-section">
    <div class="glass-card">
        <h2 style="color:var(--primary);">Examination Rules</h2>
        <div style="text-align: left; background: #fff5f5; padding: 15px; border-radius: 10px; border-left: 5px solid red; font-size: 0.9rem;">
            <p><strong>Duration:</strong> 2 Hours</p>
            <p><strong>Security:</strong> Tab switching is monitored. Leaving the screen will auto-submit your exam.</p>
            <p><strong>Uploads:</strong> Use the <b>Camera Button</b> to take photos without leaving the page.</p>
        </div>

        <div style="margin-top: 25px;">
            <label style="font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <input type="checkbox" id="agreeCheck" onchange="toggleStartBtn(this)" style="width: 20px; height: 20px;">
                I accept the University Examination Rules.
            </label>
        </div>

        <button id="startBtn" class="btn-main" disabled onclick="startExam()">Start Examination</button>
    </div>
</section>

<section id="sec-exam" class="app-section" style="display:none; align-items: flex-start; padding-top: 20px;">
    <div id="exam-interface">
        <header>
            <div>
                <h3 style="margin:0; color:var(--primary);">MP 3010</h3>
                <span id="dispName" style="font-size:0.85rem; color:#666;">Student</span>
            </div>
            <div style="background:var(--primary); color:white; padding:5px 15px; border-radius:20px; font-weight:bold;" id="timer">02:00:00</div>
        </header>

        <div class="exam-card">
            <div class="section-header"><h3>QUESTION 01 (20 Marks)</h3></div>
            <div id="mcq-container"></div>
        </div>

        <div class="exam-card">
            <div class="section-header"><h3>QUESTION 02 (20 Marks)</h3></div>
            <p><strong>A.</strong> Consider following linkage mechanism (Figure 01). Identify the mechanisms of A to C.</p>
            <img src="1.png" alt="Figure 01" class="exam-figure">
            <input type="text" placeholder="Identify A">
            <input type="text" placeholder="Identify B">
            <input type="text" placeholder="Identify C">

            <p><strong>B.</strong> Gruebler's equation is given by <b>DOF = 3(n-1) - 2L - H</b>.</p>
            <p>i. Define the terms n, L, and H.</p>
            <textarea style="height:60px;"></textarea>
            <p>ii. For the mechanism shown in Figure 02, calculate the degree of freedom. (7 marks)</p>
            <img src="2.png" alt="Figure 02" class="exam-figure">
            <textarea style="height:100px;" placeholder="Show calculation steps..."></textarea>

            <p><strong>C.</strong> The endpoint of a robotic arm is initially at <b>P=(5,2,7)</b>. The arm undergoes Euler angle rotations:</p>
            <ul>
                <li>First by <b>90¬∞ about the z-axis</b></li>
                <li>Then by <b>180¬∞ about its own x-axis</b>.</li>
            </ul>
            <p>i. Find the resulting rotation matrix.</p>
            <textarea style="height:80px;"></textarea>
            <p>ii. Determine the final coordinates of the endpoint.</p>
            <input type="text" placeholder="Final Coordinates (x,y,z)">
        </div>

        <div class="exam-card">
            <div class="section-header"><h3>QUESTION 03 (35 Marks)</h3></div>
            <p><strong>(A)</strong> The oscillating link OAB (Figure 03) is pivoted at O and moves at <b>90 r.p.m. anticlockwise</b>.</p>
            <p>Data: <b>OA=150mm, AB=75mm, AC=250mm</b>.</p>
            <img src="3.png" alt="Figure 03" class="exam-figure">

            <p>Draw Space Diagram (1:50) and Velocity Vector Diagram (1cm = 0.2m/s).</p>
            <div class="upload-area">
                <p><strong>Upload Q3(A) Diagrams</strong></p>
                <button type="button" class="btn-cam" onclick="openCamera('q3a')">üì∑ Camera</button>
                <button type="button" class="btn-file" onclick="safeUpload('f3a')">üìÇ File</button>
                <input type="file" id="f3a" style="display:none" onchange="previewFile(this, 'p3a')">
                <img id="p3a" class="preview-img">
            </div>

            <p>Calculate:</p>
            <label>1. Velocity of block C (m/s):</label><input type="number" step="0.01">
            <label>2. Angular velocity of link AC (rad/s):</label><input type="number" step="0.01">
            <label>3. Rubbing velocities at O, A, C (Pin diameters = 20mm):</label><input type="text">

            <hr style="margin:20px 0; border-top:1px dashed #ccc;">

            <p><strong>(B)</strong> Four bar chain PQRS (PS Fixed). PQ=62.5mm, QR=175mm, RS=112.5mm, PS=200mm. Crank PQ rotates <b>10 rad/s clockwise</b>.</p>
            <p>Draw velocity/acceleration diagram when <b>Angle QPS = 60¬∞</b>.</p>
            <div class="upload-area">
                <p><strong>Upload Q3(B) Diagrams</strong></p>
                <button type="button" class="btn-cam" onclick="openCamera('q3b')">üì∑ Camera</button>
                <button type="button" class="btn-file" onclick="safeUpload('f3b')">üìÇ File</button>
                <input type="file" id="f3b" style="display:none" onchange="previewFile(this, 'p3b')">
                <img id="p3b" class="preview-img">
            </div>
            <p>Find Angular Velocity & Acceleration of QR and RS:</p>
            <textarea style="height:80px;" placeholder="Enter answers..."></textarea>
        </div>

        <div class="exam-card">
            <div class="section-header"><h3>QUESTION 04 (18 Marks)</h3></div>
            <p><strong>(A)</strong> Pinion (20 teeth, module 6mm) rotates at 200 rpm, transmits 1.5kW to Wheel (50 teeth). Addendum = 1/4 circular pitch. Obliquity = 20¬∞.</p>
            <input type="text" placeholder="(a) Length of path of approach">
            <input type="text" placeholder="(b) Length of arc of approach">

            <hr style="margin:20px 0; border-top:1px dashed #ccc;">

            <p><strong>(B)</strong> Compound gear train (Figure 04). Input Gear 1 rotates <b>1200 rpm clockwise</b>.</p>
            <img src="4.png" alt="Figure 04" class="exam-figure">

            <table class="gear-table">
                <thead><tr><th>Gear</th><th>Teeth</th><th>Module</th></tr></thead>
                <tbody>
                    <tr><td>1</td><td>22</td><td>6 mm</td></tr>
                    <tr><td>2</td><td>40</td><td>6 mm</td></tr>
                    <tr><td>3</td><td>24</td><td>5 mm</td></tr>
                    <tr><td>4</td><td>24</td><td>5 mm</td></tr>
                    <tr><td>5</td><td>26</td><td>5 mm</td></tr>
                    <tr><td>6</td><td>42</td><td>5 mm</td></tr>
                    <tr><td>7</td><td>44</td><td>5 mm</td></tr>
                </tbody>
            </table>

            <p>Compute:</p>
            <ol>
                <li>Speed/Direction of Gear 7</li>
                <li>Diameter of gears 2,3,4,5,6,7</li>
                <li>Velocity ratios (1-2, 3-4, 5-6, 6-7)</li>
            </ol>
            <div class="upload-area">
                <p><strong>(Optional) Upload Calculation Sheet</strong></p>
                <button type="button" class="btn-cam" onclick="openCamera('q4')">üì∑ Camera</button>
                <button type="button" class="btn-file" onclick="safeUpload('f4')">üìÇ File</button>
                <input type="file" id="f4" style="display:none" onchange="previewFile(this, 'p4')">
                <img id="p4" class="preview-img">
            </div>
            <textarea placeholder="Or type summary of answers here..."></textarea>

            <hr style="margin:20px 0; border-top:1px dashed #ccc;">

            <p><strong>(C)</strong> A reverted epicyclic gear train for a hoist block is shown in Figure. The arm E is keyed to the same shaft as the load drum and the wheel A is keyed to a second shaft which carries a chain wheel, the chain being operated by hand.</p>
            <img src="5.png" alt="Epicyclic Train" class="exam-figure">
            <p>1. The number of teeth on wheels C and D when the speed of A is ten times the speed of arm E, both rotating in the same sense.</p>
            <p>2. The speed of wheel D when the wheel A is fixed and the arm E rotates at 450 r.p.m. Anticlockwise.</p>
            <textarea placeholder="Enter answers..."></textarea>
        </div>

        <div class="exam-card">
            <div class="section-header"><h3>QUESTION 05 (12 Marks)</h3></div>
            <p><strong>Cam Profile Design:</strong></p>
            <ul style="background:#f9f9f9; padding:15px 30px; border-radius:5px;">
                <p>A cam operating a knife-edged follower has the following data :
                <br>(a) Follower moves outwards through 40 mm during 60¬∞ of cam rotation.
                <br>(b) Follower dwells for the next 45¬∞.
                <br>(c) Follower returns to its original position during next 90¬∞.
                <br>(d) Follower dwells for the rest of the rotation.
                The displacement of the follower is to take place with simple harmonic motion during both the outward and return strokes. The least radius of the cam is 50 mm.</p>
            </ul>
            <p>Draw the profile when: 1. Axis passes through cam axis. 2. Offset 20mm right.</p>

            <div class="upload-area">
                <p><strong>Upload Cam Profile</strong></p>
                <button type="button" class="btn-cam" onclick="openCamera('q5')">üì∑ Camera</button>
                <button type="button" class="btn-file" onclick="safeUpload('f5')">üìÇ File</button>
                <input type="file" id="f5" style="display:none" onchange="previewFile(this, 'p5')">
                <img id="p5" class="preview-img">
            </div>

            <p>Determine Max Velocity & Acceleration (Outward & Return):</p>
            <input type="text" placeholder="Enter values...">
        </div>

        <button class="btn-main" onclick="submitExam('manual')">Submit Examination</button>
    </div>
</section>

<div id="camera-modal" class="modal-overlay">
    <video id="camera-feed" autoplay playsinline></video>
    <canvas id="camera-canvas" style="display:none;"></canvas>
    <div style="margin-top:20px; display:flex; gap:20px;">
        <button class="btn-cam" style="background:red;" onclick="closeCamera()">Cancel</button>
        <button class="btn-cam" style="background:green;" onclick="takePhoto()">Capture</button>
    </div>
</div>

<div id="violation-modal" class="modal-overlay">
    <div class="alert-box">
        <h2 style="color:red; font-size:2rem;">‚ö†Ô∏è EXAM TERMINATED</h2>
        <p style="font-size:1.1rem; margin: 20px 0;">You navigated away from the exam window.</p>
        <p>Your answers have been auto-submitted and a violation has been recorded.</p>
        <button class="btn-main" style="background: #333;" onclick="location.reload()">Close Portal</button>
    </div>
</div>

<div id="success-modal" class="modal-overlay">
    <div class="alert-box">
        <h2 style="color:green; font-size:2rem;">‚úÖ SUBMITTED</h2>
        <p style="font-size:1.1rem; margin: 20px 0;">Your examination has been successfully recorded.</p>
        <div style="background:#eee; padding:10px; border-radius:10px; margin-bottom:20px;">
            <p><strong>MCQ Score:</strong> <span id="final-score">0</span>/20</p>
        </div>
        <button class="btn-main" onclick="location.reload()">Return Home</button>
    </div>
</div>

<script>
    // --- MCQs ---
    const quizData = [
        { q: "1. Parameterization of rigid body motion includes?", o: ["Body/Spatial angular velocity", "Force moments", "Euler's equations", "All of the above"], a: 3 },
        { q: "2. Conserved in spatial angular momentum?", o: ["Magnitude of angular momentum", "Gyroscopic motion", "Spinning top", "None"], a: 0 },
        { q: "3. Principle of MEMS accelerometers?", o: ["Working principle", "Conservation", "Kinetic energy", "Force moment"], a: 0 },
        { q: "4. What are kinematic chains?", o: ["Mechanisms", "Pairs/DOF", "Four bar", "All of the above"], a: 3 },
        { q: "5. Law related to four bar mechanisms?", o: ["Grashof's law", "Newton's law", "Euler's law", "Kennedy's theorem"], a: 0 },
        { q: "6. Theorem associated with instantaneous center?", o: ["Kennedy's theorem", "Grashof's", "Euler's", "Newton's"], a: 0 },
        { q: "7. Law of gear meshing related to?", o: ["Types/Trains", "Design params", "Cam drives", "Both Types/Design"], a: 3 },
        { q: "8. Cam drives used for?", o: ["Motion transmit", "Change speed", "Change direction", "All of the above"], a: 3 },
        { q: "9. Euler's rigid body equations describe?", o: ["Rotating bodies", "Translating", "Both", "None"], a: 0 },
        { q: "10. Gyroscopic motion related to?", o: ["Conservation spatial momentum", "Spinning top", "Both", "None"], a: 2 }
    ];

    // --- RENDER MCQs ---
    const mcqBox = document.getElementById('mcq-container');
    quizData.forEach((item, idx) => {
        let opts = item.o.map((txt, i) => `<label style="display:block; padding:5px;"><input type="radio" name="q${idx}" value="${i}"> ${String.fromCharCode(65+i)}) ${txt}</label>`).join('');
        mcqBox.innerHTML += `<div style="margin-bottom:15px; background:#f9f9f9; padding:10px; border-radius:5px;"><p style="font-weight:600; margin-top:0;">${item.q}</p>${opts}</div>`;
    });

    // --- VARIABLES ---
    let safeMode = false;
    let currentId = null;
    let stream = null;
    let timerInterval = null;

    // --- NAVIGATION ---
    function handleLogin(e) {
        e.preventDefault();
        document.getElementById('dispName').innerText = document.getElementById('studentName').value;
        document.getElementById('sec-login').style.display = 'none';
        document.getElementById('sec-instructions').style.display = 'flex';
    }

    function toggleStartBtn(checkbox) {
        document.getElementById('startBtn').disabled = !checkbox.checked;
    }

    // --- START EXAM ---
    function startExam() {
        document.documentElement.requestFullscreen().catch(e=>{});
        document.getElementById('sec-instructions').style.display = 'none';
        document.getElementById('sec-exam').style.display = 'block';

        // Timer
        let t = 7200;
        timerInterval = setInterval(() => {
            t--;
            let h=Math.floor(t/3600), m=Math.floor((t%3600)/60), s=t%60;
            document.getElementById('timer').innerText = `${h}:${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
            if(t<=0) submitExam('timeout');
        }, 1000);

        // Security Check
        document.addEventListener('visibilitychange', () => {
            if(!safeMode && document.hidden) {
                clearInterval(timerInterval);
                document.getElementById('violation-modal').style.display = 'flex';
            }
        });
    }

    // --- SUBMIT LOGIC ---
    function submitExam(type) {
        clearInterval(timerInterval);
        
        // Calculate Score
        let score = 0;
        quizData.forEach((q, index) => {
            const selected = document.querySelector(`input[name="q${index}"]:checked`);
            if (selected && parseInt(selected.value) === q.a) score += 2;
        });
        document.getElementById('final-score').innerText = score;

        // Show Modal
        if(type === 'manual') {
            document.getElementById('success-modal').style.display = 'flex';
        } else {
             document.getElementById('violation-modal').style.display = 'flex';
        }
    }

    // --- UPLOAD & CAMERA ---
    function safeUpload(id) {
        safeMode = true;
        document.getElementById(id).click();
        setTimeout(() => safeMode = false, 2000); // Re-arm security
    }

    function previewFile(input, imgId) {
        if(input.files[0]) {
            let reader = new FileReader();
            reader.onload = e => {
                document.getElementById(imgId).src = e.target.result;
                document.getElementById(imgId).style.display = 'block';
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    async function openCamera(id) {
        safeMode = true; currentId = id;
        document.getElementById('camera-modal').style.display = 'flex';
        stream = await navigator.mediaDevices.getUserMedia({video: {facingMode: 'environment'}});
        document.getElementById('camera-feed').srcObject = stream;
    }

    function takePhoto() {
        let v = document.getElementById('camera-feed');
        let c = document.getElementById('camera-canvas');
        c.width = v.videoWidth; c.height = v.videoHeight;
        c.getContext('2d').drawImage(v,0,0);
        document.getElementById('p'+currentId.substring(1)).src = c.toDataURL('image/png');
        document.getElementById('p'+currentId.substring(1)).style.display = 'block';
        closeCamera();
    }

    function closeCamera() {
        document.getElementById('camera-modal').style.display = 'none';
        if(stream) stream.getTracks().forEach(t=>t.stop());
        setTimeout(() => safeMode = false, 1000);
    }
</script>
</body>
</html>
