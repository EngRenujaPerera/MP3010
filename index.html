<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="origin-when-cross-origin">
    <title>MP3010 - Kinematics and Dynamics</title>

    <style>
        /* --- General Page Styles --- */
        :root {
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --dark-bg: #0f172a;
            --panel-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
            --quiz-accent: #fbbf24;
            --exam-accent: #f43f5e; /* New accent color for Exam */
            --success: #10b981;
            --header-height: 60px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px); z-index: 2000;
            display: none; align-items: center; justify-content: center; padding: 20px;
        }

        .welcome-card {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 1px solid var(--border); border-radius: 20px;
            width: 100%; max-width: 800px; display: flex; flex-direction: column;
            overflow: hidden; box-shadow: 0 50px 100px -20px rgba(0,0,0,0.7);
            animation: scaleIn 0.4s ease;
            max-height: 90vh; overflow-y: auto; -webkit-overflow-scrolling: touch;
        }

        /* Report Table */
        .report-header { padding: 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .close-btn { background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer; }
        .report-content { padding: 25px; }
        .report-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .report-table th { text-align: left; color: var(--primary); font-size: 0.8rem; text-transform: uppercase; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .report-table td { padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05); color: var(--text-main); font-size: 0.95rem; }
        .score-badge { background: rgba(16, 185, 129, 0.2); color: var(--success); padding: 4px 10px; border-radius: 12px; font-weight: 700; font-size: 0.8rem; }
        .empty-state { text-align: center; color: var(--text-muted); padding: 40px; font-style: italic; }

        /* Welcome Styles */
        .welcome-header { padding: 30px; text-align: center; border-bottom: 1px solid var(--border); }
        .welcome-header h1 { margin: 0; color: #fff; font-size: 1.8rem; }
        .options-grid { display: flex; flex-direction: row; }
        .option-col { flex: 1; padding: 30px; display: flex; flex-direction: column; gap: 15px; }
        .option-col.guest { background: rgba(255,255,255,0.02); border-right: 1px solid var(--border); }
        .option-col.pro { background: rgba(59, 130, 246, 0.05); position: relative; }
        .badge { position: absolute; top: 15px; right: 15px; background: var(--quiz-accent); color: #000; font-size: 0.7rem; font-weight: 800; padding: 4px 10px; border-radius: 20px; text-transform: uppercase; }
        .benefit-list { list-style: none; padding: 0; margin: 0; }
        .benefit-item { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; font-size: 0.9rem; color: var(--text-muted); }
        .icon-check { color: var(--success); font-weight: bold; }
        .icon-cross { color: #ef4444; font-weight: bold; }
        .btn-welcome { padding: 14px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; margin-top: auto; transition: transform 0.2s; font-size: 1rem; }
        .btn-guest { background: transparent; border: 1px solid var(--border); color: var(--text-muted); }
        .btn-pro { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4); }

        @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* --- Layout --- */
        .mobile-header { display: none; height: var(--header-height); background: var(--panel-bg); border-bottom: 1px solid var(--border); align-items: center; padding: 0 15px; justify-content: space-between; position: fixed; top: 0; left: 0; right: 0; z-index: 50; }
        .mobile-menu-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 5px; }
        .mobile-title { font-size: 1rem; font-weight: 700; color: white; }

        .sidebar { width: 360px; background-color: var(--panel-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; z-index: 100; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

        /* Dashboard & Stats */
        .sidebar-dashboard { padding: 20px; background: rgba(0,0,0,0.2); border-bottom: 1px solid var(--border); }
        .user-greeting { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .u-avatar { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--primary); object-fit: cover; }
        .u-text h3 { margin: 0; font-size: 1rem; color: #fff; font-weight: 600; }
        .u-text span { font-size: 0.75rem; font-weight: 700; letter-spacing: 0.5px; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-box { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; text-align: center; }
        .stat-val { display: block; font-size: 1.1rem; font-weight: 700; color: #fff; }
        .stat-label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }

        .action-btn-group { display: flex; gap: 8px; }
        .dash-btn { flex: 1; padding: 10px; border-radius: 6px; font-size: 0.8rem; cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 6px; border: 1px solid transparent; transition: all 0.2s; }
        .btn-resume { background: rgba(16, 185, 129, 0.15); color: var(--success); border-color: rgba(16, 185, 129, 0.3); }
        .btn-report { background: rgba(251, 191, 36, 0.15); color: var(--quiz-accent); border-color: rgba(251, 191, 36, 0.3); }
        .btn-resume:hover { background: rgba(16, 185, 129, 0.25); }
        .btn-report:hover { background: rgba(251, 191, 36, 0.25); }

        .course-meta { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .course-meta h2 { margin: 0; font-size: 1rem; font-weight: 700; color: #fff; }
        .course-meta span { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--primary); font-weight: 700; }

        .sidebar-nav { display: flex; background: rgba(0,0,0,0.2); border-radius: 6px; padding: 4px; gap: 4px; margin-top: 15px; }
        .s-nav-btn { flex: 1; background: none; border: none; color: var(--text-muted); padding: 8px; font-size: 0.8rem; font-weight: 600; border-radius: 4px; cursor: pointer; transition: all 0.2s; text-align: center; }
        .s-nav-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

        /* Sidebar Content */
        .sidebar-content { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; }

        .sidebar-item { display: flex; align-items: center; padding: 14px 20px; cursor: pointer; border-bottom: 1px solid rgba(51, 65, 85, 0.3); transition: all 0.2s; gap: 12px; }
        .sidebar-item:hover { background-color: rgba(59, 130, 246, 0.1); }
        .sidebar-item.active { background-color: rgba(59, 130, 246, 0.15); border-left: 4px solid var(--primary); }

        .sidebar-item.is-quiz .item-icon { background: rgba(234, 179, 8, 0.1); color: var(--quiz-accent); }
        .sidebar-item.active.is-quiz .item-icon { background: var(--quiz-accent); color: #000; }
        
        /* New Exam Style */
        .sidebar-item.is-exam .item-icon { background: rgba(244, 63, 94, 0.1); color: var(--exam-accent); }
        .sidebar-item.active.is-exam .item-icon { background: var(--exam-accent); color: white; }

        .item-icon { width: 32px; height: 32px; border-radius: 6px; background: rgba(255,255,255,0.05); color: var(--text-muted); display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
        .sidebar-item.active .item-icon { background: var(--primary); color: white; }
        .item-info { flex-grow: 1; }
        .item-info h4 { margin: 0; font-size: 0.9rem; font-weight: 500; color: var(--text-main); line-height: 1.4; }
        .item-info span { font-size: 0.75rem; color: var(--text-muted); }

        /* NEW: Sidebar Footer (Logout) */
        .sidebar-footer-controls { padding: 15px; border-top: 1px solid var(--border); background: rgba(0,0,0,0.2); margin-top: auto; }
        .btn-logout { width: 100%; padding: 10px; background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-logout:hover { background: rgba(239, 68, 68, 0.2); }

        .sidebar-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 90; backdrop-filter: blur(2px); opacity: 0; transition: opacity 0.3s; }

        /* --- Main Content --- */
        .main-stage { flex-grow: 1; display: flex; flex-direction: column; padding: 0; background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%); overflow-y: auto; position: relative; }
        .content-wrapper { width: 100%; max-width: 1100px; margin: 0 auto; padding: 40px; flex-grow: 1; display: flex; flex-direction: column; }

        .viewport-container { width: 100%; aspect-ratio: 16 / 9; border-radius: 12px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7); background: #000; position: relative; animation: slideUp 0.6s ease forwards; }
        .viewport-container iframe { width: 100%; height: 100%; border: none; position: absolute; top: 0; left: 0; }

        /* Quiz Start Screen */
        .quiz-start-screen { display: none; width: 100%; height: 100%; background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px; box-sizing: border-box; }
        .quiz-icon-large { font-size: 4rem; margin-bottom: 20px; background: rgba(251, 191, 36, 0.1); width: 100px; height: 100px; display: flex; align-items: center; justify-content: center; border-radius: 50%; color: var(--quiz-accent); }
        .quiz-title-display { font-size: 2rem; color: white; margin-bottom: 10px; }
        .quiz-desc-display { color: var(--text-muted); margin-bottom: 30px; max-width: 400px; }
        .start-quiz-btn { background-color: var(--quiz-accent); color: #000; padding: 15px 40px; font-size: 1.1rem; font-weight: 700; border: none; border-radius: 8px; cursor: pointer; text-decoration: none; margin-bottom: 15px; }

        /* Auto-save notification */
        .auto-save-note { font-size: 0.8rem; color: var(--success); margin-top: 10px; display: flex; align-items: center; gap: 5px; opacity: 0; transition: opacity 0.3s; }

        .current-video-title { margin-top: 25px; font-size: 1.5rem; color: #fff; opacity: 0; animation: fadeIn 0.5s forwards 0.3s; }

        .resources-section { margin-top: 30px; background: var(--panel-bg); border-radius: 12px; border: 1px solid var(--border); overflow: hidden; opacity: 0; animation: fadeIn 0.5s forwards 0.5s; }
        .tabs-header { display: flex; border-bottom: 1px solid var(--border); background: rgba(15, 23, 42, 0.5); overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .tabs-header::-webkit-scrollbar { display: none; }
        .tab-btn { background: none; border: none; padding: 16px 24px; color: var(--text-muted); font-family: inherit; font-weight: 600; cursor: pointer; transition: all 0.2s; position: relative; white-space: nowrap; flex-shrink: 0; }
        .tab-btn:hover { color: var(--text-main); background: rgba(255,255,255,0.05); }
        .tab-btn.active { color: var(--primary); }
        .tab-btn.active::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 3px; background: var(--primary); }
        .tab-content { padding: 24px; display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        .resource-list { list-style: none; padding: 0; margin: 0; }
        .resource-item { display: flex; align-items: center; padding: 12px; border-radius: 8px; background: rgba(15, 23, 42, 0.3); margin-bottom: 10px; border: 1px solid transparent; transition: all 0.2s; }
        .resource-item:hover { background: rgba(15, 23, 42, 0.5); border-color: rgba(59, 130, 246, 0.3); }
        .resource-icon { width: 40px; height: 40px; background: rgba(59, 130, 246, 0.1); color: var(--primary); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold; font-size: 0.8rem; flex-shrink: 0;}
        .resource-details { flex-grow: 1; min-width: 0; }
        .resource-name { display: block; font-weight: 500; color: var(--text-main); margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .resource-meta { font-size: 0.8rem; color: var(--text-muted); }
        .view-btn { background: var(--primary); color: white; text-decoration: none; padding: 8px 16px; border-radius: 6px; font-size: 0.85rem; font-weight: 500; cursor: pointer; flex-shrink: 0; }

        /* Footer */
        .course-footer { margin-top: 40px; padding-top: 25px; border-top: 1px solid var(--border); text-align: center; color: var(--text-muted); font-size: 0.85rem; line-height: 1.6; opacity: 0.8; }
        .footer-highlight { color: var(--text-main); font-weight: 600; }
        .heart-icon { color: #ef4444; display: inline-block; animation: heartbeat 1.5s infinite; }
        @keyframes heartbeat { 0% { transform: scale(1); } 15% { transform: scale(1.2); } 30% { transform: scale(1); } 100% { transform: scale(1); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { to { opacity: 1; } }

        @media (max-width: 900px) {
            body { flex-direction: column; overflow: hidden; }
            .mobile-header { display: flex; }
            .sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: 85%; max-width: 320px; transform: translateX(-100%); box-shadow: 4px 0 15px rgba(0,0,0,0.5); height: 100%; border-right: none; }
            .sidebar.open { transform: translateX(0); }
            .sidebar-overlay.active { display: block; opacity: 1; }
            .main-stage { padding-top: var(--header-height); }
            .content-wrapper { padding: 0; width: 100%; }
            .viewport-container { border-radius: 0; }
            .current-video-title { padding: 0 20px; font-size: 1.2rem; margin-top: 20px; }
            .resources-section { margin: 20px; border-radius: 8px; }
            .tab-btn { padding: 12px 20px; }
            .quiz-title-display { font-size: 1.5rem; }
            .quiz-desc-display { font-size: 0.9rem; }
            .options-grid { flex-direction: column; }
            .option-col.guest { border-right: none; border-bottom: 1px solid var(--border); }
            .welcome-card { margin: 0 auto; max-width: 95%; }
            .welcome-header { padding: 20px; }
            .option-col { padding: 20px; }
            .welcome-header h1 { font-size: 1.4rem; }
            .course-footer { padding-bottom: 30px; margin: 20px; }
        }
    </style>
</head>
<body>

    <div class="modal-overlay" id="welcomeModal">
        <div class="welcome-card">
            <div class="welcome-header">
                <h1>Welcome to Kinematics & Dynamics</h1>
                <p>How would you like to access the course materials?</p>
            </div>
            <div class="options-grid">
                <div class="option-col guest">
                    <h3>üë§ Guest Mode</h3>
                    <ul class="benefit-list">
                        <li class="benefit-item"><span class="icon-check">‚úì</span> Watch all videos</li>
                        <li class="benefit-item"><span class="icon-check">‚úì</span> Access PDF notes</li>
                        <li class="benefit-item"><span class="icon-cross">‚úï</span> Progress is lost on exit</li>
                        <li class="benefit-item"><span class="icon-cross">‚úï</span> No quiz tracking</li>
                    </ul>
                    <button class="btn-welcome btn-guest" onclick="selectMode('guest')">Continue Anonymously</button>
                </div>
                <div class="option-col pro">
                    <span class="badge">Recommended</span>
                    <h3>üéì Student Portal</h3>
                    <ul class="benefit-list">
                        <li class="benefit-item"><span class="icon-check">‚úì</span> <b>Lifetime Progress Save</b></li>
                        <li class="benefit-item"><span class="icon-check">‚úì</span> Track Total Study Hours</li>
                        <li class="benefit-item"><span class="icon-check">‚úì</span> Save Quiz Scores</li>
                        <li class="benefit-item"><span class="icon-check">‚úì</span> Resume exact video spot</li>
                    </ul>
                    <button class="btn-welcome btn-pro" onclick="selectMode('student')">Login / Sign Up</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="reportModal">
        <div class="welcome-card">
            <div class="report-header">
                <h2 style="margin:0; color:white;">üìä My Quiz Report</h2>
                <button class="close-btn" onclick="toggleReport()">√ó</button>
            </div>
            <div class="report-content">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>Quiz Name</th>
                            <th style="text-align:center;">Attempts</th>
                            <th style="text-align:right;">Last Score</th>
                        </tr>
                    </thead>
                    <tbody id="reportList">
                        </tbody>
                </table>
                <div id="emptyReport" class="empty-state">No quizzes attempted yet.</div>
            </div>
        </div>
    </div>

    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <header class="mobile-header">
        <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
        <div class="mobile-title">Kinematics & Dynamics</div>
        <div style="width: 24px;"></div>
    </header>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-dashboard">
            <div class="user-greeting">
                <img src="https://ui-avatars.com/api/?name=Guest&background=334155&color=fff" class="u-avatar" id="avatarDisplay">
                <div class="u-text">
                    <h3 id="nameDisplay">Guest User</h3>
                    <span id="roleDisplay">Not Tracking</span>
                </div>
            </div>

            <div class="stats-grid" id="statsGrid" style="opacity: 0.5;">
                <div class="stat-box">
                    <span class="stat-val" id="timeVal">00:00:00</span>
                    <span class="stat-label">Total Study Time</span>
                </div>
                <div class="stat-box">
                    <span class="stat-val" id="progressVal">0%</span>
                    <span class="stat-label">Course Complete</span>
                </div>
            </div>

            <div class="action-btn-group">
                <button class="dash-btn btn-resume" id="resumeBtn" onclick="resumeLastVideo()" style="display:none;">
                    <span>‚ñ∂</span> Resume
                </button>
                <button class="dash-btn btn-report" id="reportBtn" onclick="toggleReport()" style="display:none;">
                    <span>üìä</span> Report
                </button>
            </div>

            <div class="course-meta">
                <span>Course Module</span>
                <h2>Kinematics & Dynamics</h2>
            </div>

            <div class="sidebar-nav">
                <button class="s-nav-btn active" onclick="renderSidebar('lessons')">Lessons</button>
                <button class="s-nav-btn" onclick="renderSidebar('slides')">Files</button>
            </div>
        </div>

        <ul class="sidebar-content" id="sidebar-list"></ul>

        <div class="sidebar-footer-controls">
            <button class="btn-logout" onclick="handleLogout()">
                <span>üö™</span> Log Out / Reset
            </button>
        </div>
    </aside>

    <main class="main-stage">
        <div class="content-wrapper">

            <div class="viewport-container">
                <iframe id="course-player" src="" title="Course Content" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

                <div id="quiz-screen" class="quiz-start-screen">
                    <div class="quiz-icon-large" id="statusIcon">üìù</div>
                    <h2 class="quiz-title-display" id="quizTitleDisplay">Quiz Name</h2>
                    <p class="quiz-desc-display" id="statusDesc"></p>
                    <button id="launchQuizBtn" class="start-quiz-btn">Start Quiz</button>
                    <div id="autoSaveNote" class="auto-save-note">
                        <span>‚úì</span> Attempt recorded automatically
                    </div>
                </div>
            </div>

            <h2 class="current-video-title" id="videoTitle">Select a Lesson</h2>

            <div class="resources-section">
                <div class="tabs-header">
                    <button class="tab-btn active" onclick="switchTab('notes')">Notes</button>
                    <button class="tab-btn" onclick="switchTab('slides')">Slides</button>
                    <button class="tab-btn" onclick="switchTab('tutes')">Tutorials</button>
                </div>

                <div id="tab-notes" class="tab-content active"><ul class="resource-list" id="list-notes"></ul></div>
                <div id="tab-slides" class="tab-content"><ul class="resource-list" id="list-slides"></ul></div>
                <div id="tab-tutes" class="tab-content"><ul class="resource-list" id="list-tutes"></ul></div>
            </div>

            <footer class="course-footer">
                <div>&copy; 2025 <span class="footer-highlight">Faculty of Engineering</span> | E23 Batch</div>
                <div style="margin-top:5px;">Made <span class="heart-icon">‚ù§Ô∏è</span> with E23 Brotherhood</div>
            </footer>

        </div>
    </main>

    <script>
        // --- Shared Resource Definitions ---
        const resources = {
            day1: [ { name: "Day 01 Presentation", type: "PPTX", size: "3.2 MB", url: "slides/Day 01.pptx" }, { name: "Day 01 PDF View", type: "PDF", size: "2.1 MB", url: "slides/Day 01.pdf" } ],
            day2: [ { name: "Day 02 Presentation", type: "PPTX", size: "3.1 MB", url: "slides/Day 02.pptx" }, { name: "Day 02 PDF View", type: "PDF", size: "1.4 MB", url: "slides/Day 02.pdf" } ],
            day3: [ { name: "Day 03 Presentation", type: "PPTX", size: "17.8 MB", url: "slides/Day 03.pptx" }, { name: "Day 03 PDF View", type: "PDF", size: "2.2 MB", url: "slides/Day 03.pdf" } ],
            day3_tute: [ { name: "Day 03 Tutorial", type: "PDF", size: "458 KB", url: "slides/Day 03 Tute.pdf" } ],
            day4: [ { name: "Day 04 Presentation", type: "PPTX", size: "6.3 MB", url: "slides/Day 04.pptx" }, { name: "Day 04 PDF View", type: "PDF", size: "3.2 MB", url: "slides/Day 04.pdf" } ],
            day4_tute: [ { name: "Day 04 Tutorial", type: "PDF", size: "340 KB", url: "slides/Day 4 Tute.pdf" } ],
            day5: [ { name: "Day 05 Presentation", type: "PPTX", size: "3.3 MB", url: "slides/Day 05.pptx" }, { name: "Day 05 PDF View", type: "PDF", size: "2.3 MB", url: "slides/Day 05.pdf" } ],
            empty: { notes: [], slides: [], tutes: [] }
        };

        const courseContent = [
            { title: "Lecture 1: Rigid Body Dynamics", type: "video", id: "Nj3Ntg_QupA", resources: { notes: [ { name: "Lecture 1 PDF", type: "PDF", size: "915 KB", url: "files/Lecture1_Rigid body dynamics.pdf" } ], slides: resources.day1, tutes: [] } },
            { title: "Lecture 2: Time Rate of Vector", type: "video", id: "Nj3Ntg_QupA", resources: { notes: [ { name: "Lecture 2 PDF", type: "PDF", size: "434 KB", url: "files/Lecture2_Time rate of vector in rotational motion.pdf" } ], slides: resources.day1, tutes: [] } },
            { title: "Lecture 3: Intermediate Frames", type: "video", id: "DccSNMkR3dI", resources: { notes: [ { name: "Lecture 3 PDF", type: "PDF", size: "536 KB", url: "files/Lecture3_Intermediate frames.pdf" } ], slides: resources.day1, tutes: [] } },
            { title: "Lecture 4: Kinematic Expressions", type: "video", id: "DccSNMkR3dI", resources: { notes: [ { name: "Lecture 4 PDF", type: "PDF", size: "873 KB", url: "files/Lecture4_Generalizations of kinematic expressions.pdf" } ], slides: resources.day1, tutes: [] } },
            { title: "Lecture 5: Momentum Analysis", type: "video", id: "DccSNMkR3dI", resources: { notes: [ { name: "Lecture 5 PDF", type: "PDF", size: "1.28 MB", url: "files/Lecture5_Momentum analysis.pdf" } ], slides: resources.day1, tutes: [] } },
            { title: "Lecture 6: Inertia Tensor", type: "video", id: "hZ2ODrVfj3g", resources: { notes: [ { name: "Lecture 6 PDF", type: "PDF", size: "1.05 MB", url: "files/Lecture6_Inertia tensor.pdf" } ], slides: resources.day1, tutes: [] } },
            { title: "Lecture 7: Parallel Axes Theorem", type: "video", id: "hZ2ODrVfj3g", resources: { notes: [ { name: "Lecture 7 PDF", type: "PDF", size: "455 KB", url: "files/Lecture7_Parallel axes theorem.pdf" } ], slides: resources.day1, tutes: [] } },
            { title: "Quiz 01: Checkpoint", type: "quiz", url: "quiz/quiz1.html", resources: resources.empty },
            { title: "Lecture 8: Coordinate Frames", type: "video", id: "sIpWLFL5E-s", resources: { notes: [ { name: "Lecture 8 PDF", type: "PDF", size: "606 KB", url: "files/Lecture8_Coordinate frames, Mapping and Transformation matrix.pdf" } ], slides: resources.day2, tutes: [] } },
            { title: "Lecture 9: Fundamental Rotation Matrices", type: "video", id: "cwx5lCeYKqM", resources: { notes: [ { name: "Lecture 9 PDF", type: "PDF", size: "941 KB", url: "files/Lecture9_Fundamental rotation matrices.pdf" } ], slides: resources.day2, tutes: [] } },
            { title: "Quiz 02: Rotation Matrices", type: "quiz", url: "quiz/quiz2.html", resources: resources.empty },
            { title: "Lecture 10: Linkage Mechanisms", type: "video", id: "9ZrshlMcU8w", resources: { notes: [ { name: "Lecture 10 PDF", type: "PDF", size: "2.25 MB", url: "files/Lecture10_Linkage mechanisms.pdf" } ], slides: resources.day3, tutes: resources.day3_tute } },
            { title: "Quiz 03: Mechanisms", type: "quiz", url: "quiz/quiz3.html", resources: resources.empty },
            { title: "Lecture 11: Velocity Analysis (ICM)", type: "video", id: null, resources: { notes: [ { name: "Lecture 11 PDF", type: "PDF", size: "882 KB", url: "files/Lecture11_Velocity analysis_ICM.pdf" } ], slides: resources.day3, tutes: resources.day3_tute } },
            { title: "Lecture 12: Velocity Analysis (VVD)", type: "video", id: "C-Le56Nvhr8", resources: { notes: [ { name: "Lecture 12 PDF", type: "PDF", size: "3.91 MB", url: "files/Lecture12_Velocity analysis_VVD.pdf" } ], slides: resources.day3, tutes: resources.day3_tute } },
            { title: "Lecture 13: Acceleration Vector Diagram", type: "video", id: "QTHzsPW3Tdg", resources: { notes: [ { name: "Lecture 13 PDF", type: "PDF", size: "684 KB", url: "files/Lecture13_Acceleration Vector Diagram.pdf" } ], slides: resources.day3, tutes: resources.day3_tute } },
            { title: "Lecture 14: Gears", type: "video", id: "ZOvJ40aZlC8", resources: { notes: [ { name: "Lecture 14 PDF", type: "PDF", size: "2.41 MB", url: "files/Lecture14_Gears.pdf" } ], slides: [ ...resources.day4, { name: "Gear Full Slide", type: "PDF", size: "3.2 MB", url: "slides/Gear full.pdf" } ], tutes: resources.day4_tute } },
            { title: "Lecture 15: Gear Trains", type: "video", id: "Mg2bmKAvHZI", resources: { notes: [ { name: "Lecture 15 PDF", type: "PDF", size: "2.0 MB", url: "files/Lecture15_Gear Trains.pdf" } ], slides: resources.day4, tutes: resources.day4_tute } },
            { title: "Quiz 04: Gears", type: "quiz", url: "quiz/quiz4.html", resources: resources.empty },
            { title: "Lecture 16: Cams", type: "video", id: "GV1tlgHpMs0", resources: { notes: [ { name: "Lecture 16 PDF", type: "PDF", size: "983 KB", url: "files/Lecture16_Cams.pdf" } ], slides: resources.day5, tutes: [] } },
            { title: "Lecture 17: Cam Profile", type: "video", id: "GV1tlgHpMs0", resources: { notes: [ { name: "Lecture 17 PDF", type: "PDF", size: "2.07 MB", url: "files/Lecture17_Cam profile.pdf" } ], slides: resources.day5, tutes: [] } },
            { title: "Lecture 18: Gyroscope", type: "video", id: null, resources: { notes: [ { name: "Lecture 18 PDF (Updated)", type: "PDF", size: "2.70 MB", url: "files/Lecture18_Gyroscope_updated.pdf" } ], slides: [], tutes: [] } },
            { title: "Lecture 19: Introduction to MEMS", type: "video", id: null, resources: { notes: [ { name: "Lecture 19 PDF", type: "PDF", size: "433 KB", url: "files/Lecture19_Introduction to MEMS.pdf" } ], slides: [], tutes: [] } },
            { title: "Quiz 05: Advanced Topics", type: "quiz", url: "quiz/quiz5.html", resources: resources.empty },
            { title: "Online End Examination", type: "quiz", url: "papers/exam1.html", resources: resources.empty }
        ];

        // --- 3. LOGIC CONTROLLER ---
        const modal = document.getElementById('welcomeModal');
        const reportModal = document.getElementById('reportModal');
        let currentUser = null;
        let engagedSeconds = 0;
        let lastVideoIndex = -1;
        let activeQuizIndex = -1;

        // Startup
        function checkState() {
            const userSession = localStorage.getItem('currentUser');
            const guestMode = localStorage.getItem('guestMode');

            if (userSession) {
                currentUser = JSON.parse(userSession);
                initStudentMode();
            } else if (guestMode) {
                initGuestMode();
            } else {
                modal.style.display = 'flex';
            }
        }

        function selectMode(mode) {
            if (mode === 'student') window.location.href = "login.html";
            else {
                localStorage.setItem('guestMode', 'true');
                modal.style.display = 'none';
                initGuestMode();
            }
        }

        function initStudentMode() {
            document.getElementById('nameDisplay').textContent = currentUser.name || "Student";
            document.getElementById('roleDisplay').textContent = "Tracking Active";
            document.getElementById('roleDisplay').style.color = "#10b981";
            if(currentUser.photo) document.getElementById('avatarDisplay').src = currentUser.photo;
            document.getElementById('statsGrid').style.opacity = "1";

            // Load saved total time
            const savedTime = localStorage.getItem('totalStudyTime');
            if(savedTime) engagedSeconds = parseInt(savedTime);

            startEngagementTimer();
            checkResumeStatus();
            document.getElementById('reportBtn').style.display = 'flex'; // Show report button
            listenForScores(); // Start listening for quiz data
        }

        function initGuestMode() {
            document.getElementById('nameDisplay').textContent = "Guest User";
            document.getElementById('roleDisplay').textContent = "Progress Not Saved";
            document.getElementById('roleDisplay').style.color = "#ef4444";
            startEngagementTimer();
            checkResumeStatus();
        }

        // --- 4. TIME TRACKING LOGIC (HH:MM:SS) ---
        function startEngagementTimer() {
            setInterval(() => {
                engagedSeconds++;
                document.getElementById('timeVal').textContent = formatTime(engagedSeconds);

                // Save every 5 seconds if student
                if(currentUser && engagedSeconds % 5 === 0) {
                    localStorage.setItem('totalStudyTime', engagedSeconds);
                }
            }, 1000);
        }

        function formatTime(totalSeconds) {
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;
            return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }

        function checkResumeStatus() {
            const savedIndex = localStorage.getItem('lastVideoIndex');
            if(savedIndex !== null && savedIndex !== undefined) {
                document.getElementById('resumeBtn').style.display = 'flex';
                lastVideoIndex = parseInt(savedIndex);
            }
        }

        function resumeLastVideo() {
            if(lastVideoIndex > -1) {
                loadContent(lastVideoIndex, true);
                if(window.innerWidth <= 900) {
                    toggleSidebar();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
        }

        // --- 5. AUTOMATED QUIZ LOGIC ---
        function toggleReport() {
            if(reportModal.style.display === 'flex') {
                reportModal.style.display = 'none';
            } else {
                reportModal.style.display = 'flex';
                renderReport();
            }
        }

        function renderReport() {
            const list = document.getElementById('reportList');
            const empty = document.getElementById('emptyReport');
            const quizData = JSON.parse(localStorage.getItem('quizData')) || {};

            list.innerHTML = '';
            let hasData = false;

            for (const [key, data] of Object.entries(quizData)) {
                hasData = true;
                const row = document.createElement('tr');
                // Check if score exists, otherwise show 'Pending'
                const scoreDisplay = data.score !== undefined ? data.score + "%" : "Pending";
                row.innerHTML = `
                    <td>${data.title}</td>
                    <td style="text-align:center;">${data.attempts}</td>
                    <td style="text-align:right;"><span class="score-badge">${scoreDisplay}</span></td>
                `;
                list.appendChild(row);
            }

            empty.style.display = hasData ? 'none' : 'block';
        }

        // Automatic Attempt Register
        function registerAttempt(index) {
            if(!currentUser) return; // Don't track guests

            let allQuizData = JSON.parse(localStorage.getItem('quizData')) || {};
            const quizTitle = courseContent[index].title;
            const quizKey = "q_" + index;

            // Initialize or update
            let currentData = allQuizData[quizKey] || { title: quizTitle, attempts: 0 };
            currentData.attempts += 1;

            allQuizData[quizKey] = currentData;
            localStorage.setItem('quizData', JSON.stringify(allQuizData));

            // Show Toast
            const note = document.getElementById('autoSaveNote');
            note.style.opacity = '1';
            setTimeout(() => { note.style.opacity = '0'; }, 3000);
        }

        // Listener for Scores from External Quiz Files
        function listenForScores() {
            window.addEventListener('storage', (e) => {
                if (e.key === 'quizData') {
                    // Update report if open
                    if(reportModal.style.display === 'flex') renderReport();
                }
            });
        }

        // --- LOGOUT LOGIC ---
        function handleLogout() {
            if(confirm("Are you sure you want to log out?")) {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('guestMode');
                window.location.reload();
            }
        }

        // --- 6. CORE NAVIGATION ---
        const sidebar = document.getElementById('sidebar');
        const overlay = document.querySelector('.sidebar-overlay');
        const sidebarList = document.getElementById('sidebar-list');
        const titleEl = document.getElementById('videoTitle');
        const iframeEl = document.getElementById('course-player');

        const quizScreen = document.getElementById('quiz-screen');
        const quizTitleDisplay = document.getElementById('quizTitleDisplay');
        const statusIcon = document.getElementById('statusIcon');
        const statusDesc = document.getElementById('statusDesc');
        const launchQuizBtn = document.getElementById('launchQuizBtn');

        let currentMode = 'lessons';
        let activeIndex = 0;

        document.addEventListener('DOMContentLoaded', () => {
            checkState();
            renderSidebar('lessons');
            loadContent(0, false);
        });

        function toggleSidebar() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function renderSidebar(mode) {
            currentMode = mode;
            document.querySelectorAll('.s-nav-btn').forEach(btn => {
                const btnMode = btn.innerText.toLowerCase();
                if(btnMode === mode || (btnMode === 'lessons' && mode === 'lessons')) btn.classList.add('active');
                else btn.classList.remove('active');
            });

            sidebarList.innerHTML = '';
            courseContent.forEach((item, index) => {
                let icon, sub, type;
                let isExam = false;
                
                if (item.type === 'quiz') { 
                    if (item.title.includes("Examination")) {
                         icon = 'üéì'; 
                         sub = 'Final Assessment';
                         isExam = true;
                    } else {
                         icon = 'üìù'; 
                         sub = 'Assessment';
                    }
                    type='quiz'; 
                }
                else { icon = '‚ñ∂'; sub = 'Video Lesson'; type='video'; }

                if (mode === 'slides') {
                    const count = item.resources.notes.length + item.resources.slides.length + item.resources.tutes.length;
                    icon = 'üìë'; sub = count > 0 ? `${count} File(s)` : 'No Files';
                }

                const li = document.createElement('li');
                li.className = 'sidebar-item';
                if(type === 'quiz') li.classList.add('is-quiz');
                if(isExam) li.classList.add('is-exam');

                li.dataset.index = index;
                li.innerHTML = `<div class="item-icon">${icon}</div><div class="item-info"><h4>${item.title}</h4><span>${sub}</span></div>`;
                li.onclick = () => handleSidebarClick(index);

                sidebarList.appendChild(li);
            });
            updateSidebarHighlight();
        }

        function updateSidebarHighlight() {
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
                if (parseInt(item.dataset.index) === activeIndex) item.classList.add('active');
            });
        }

        function handleSidebarClick(index) {
            activeIndex = index;
            loadContent(index, true);
            updateSidebarHighlight();
            if(window.innerWidth <= 900) toggleSidebar();

            if (currentMode === 'slides') {
                if (courseContent[index].resources.notes.length === 0 && courseContent[index].resources.slides.length > 0) switchTab('slides');
                else switchTab('notes');
                document.querySelector('.resources-section').scrollIntoView({behavior: 'smooth'});
            }
        }

        function loadContent(index, autoPlay) {
            const item = courseContent[index];
            titleEl.textContent = item.title;
            activeIndex = index;

            // SAVE PROGRESS (Simple Tracking)
            localStorage.setItem('lastVideoIndex', index);
            const progress = Math.round(((index + 1) / courseContent.length) * 100);
            document.getElementById('progressVal').textContent = progress + "%";

            if (item.type === 'quiz') {
                iframeEl.style.display = 'none'; iframeEl.src = "";
                quizScreen.style.display = 'flex';
                statusIcon.textContent = item.title.includes("Examination") ? 'üéì' : 'üìù';
                quizTitleDisplay.textContent = item.title;
                statusDesc.textContent = "";
                launchQuizBtn.style.display = 'inline-block';
                launchQuizBtn.textContent = item.title.includes("Examination") ? "Begin Examination" : "Start Quiz";

                // AUTOMATIC ATTEMPT TRACKING
                launchQuizBtn.onclick = function() {
                    registerAttempt(index);
                    window.open(item.url, '_blank');
                };

            } else if (item.type === 'video' && !item.id) {
                iframeEl.style.display = 'none'; iframeEl.src = "";
                quizScreen.style.display = 'flex';
                statusIcon.textContent = '‚è≥';
                quizTitleDisplay.textContent = item.title;
                statusDesc.textContent = "Video is not available yet.";
                launchQuizBtn.style.display = 'none';

            } else {
                quizScreen.style.display = 'none';
                iframeEl.style.display = 'block';
                let originParam = (window.location.protocol !== 'file:') ? `&origin=${window.location.origin}` : '';
                const autoPlayParam = autoPlay ? '&autoplay=1' : '';
                iframeEl.src = `https://www.youtube.com/embed/${item.id}?rel=0${originParam}${autoPlayParam}`;
            }
            updateResources(item.resources);
        }

        function updateResources(resources) {
            const generateList = (items, typeIcon) => {
                if (!items || items.length === 0) return `<li style="padding:15px; color:#94a3b8; text-align:center;">No items available.</li>`;
                return items.map(item => `
                    <li class="resource-item">
                        <div class="resource-icon">${typeIcon}</div>
                        <div class="resource-details"><span class="resource-name">${item.name}</span><span class="resource-meta">${item.type} ‚Ä¢ ${item.size}</span></div>
                        <a href="${item.url || '#'}" class="view-btn" target="_blank">View</a>
                    </li>
                `).join('');
            };
            document.getElementById('list-notes').innerHTML = generateList(resources.notes, 'DOC');
            document.getElementById('list-slides').innerHTML = generateList(resources.slides, 'PPT');
            document.getElementById('list-tutes').innerHTML = generateList(resources.tutes, 'TUT');
        }

        window.switchTab = function(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if(btn.getAttribute('onclick').includes(tabName)) btn.classList.add('active');
            });
        };
    </script>
</body>
</html>
